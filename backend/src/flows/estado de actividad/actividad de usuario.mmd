flowchart TD
    A[ðŸ‘¤ Usuario abre aplicaciÃ³n] --> B[ðŸ”Œ Socket.IO conecta]
    B --> C[âœ… user.online = true]
    C --> D[ðŸ’¾ Guardar en BD]
    
    D --> E[â° Iniciar heartbeat]
    E --> F[ðŸ“¡ Emitir userStatus cada 5 min]
    
    F --> G{Â¿Usuario activo?}
    G -->|SÃ| H[âœ… Mantener online]
    G -->|NO| I[âŒ Marcar offline]
    
    H --> J[ðŸ”„ Continuar heartbeat]
    I --> K[ðŸ’¾ Actualizar BD: online = false]
    
    L[ðŸ• Backend verifica cada 5 seg] --> M{Â¿updatedAt > 5 min?}
    M -->|SÃ| N[âœ… Usuario activo]
    M -->|NO| O[âŒ Timeout automÃ¡tico]
    
    O --> P[ðŸ’¾ online = false]
    P --> Q[ðŸ”” Notificar cambio de estado]
    
    style A fill:#e1f5fe
    style C fill:#c8e6c9
    style I fill:#ffcdd2
    style O fill:#ffcdd2